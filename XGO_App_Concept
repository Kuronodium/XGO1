# XGOアプリ指針（9x9・障害物X・整理モード・スコア判定）

> 本書は「今回作るXGOアプリ」のプロダクト指針（仕様メモ）であり、コーディング規約や一般的なXGOルール本文とは分離する。

---

## 1. ゴール（このアプリで達成すること）

* **2人対戦**で遊べる
* **9x9盤**で短時間に遊べる
* 開始時に **障害物（X）を4つ**置く（配置はランダム、開始前にON/OFF選択できる）
* 終局時は **整理モード**に移行し、盤面上の石を自由に動かして整理できる
* 整理後に **判定ボタン**を押すとスコアを算出して表示する

---

## 2. 前提・スコープ

### 2-1. 対象プラットフォーム

* まずはデスクトップ（マウス操作）を主対象

### 2-2. スコープに入れる

* 2人プレイ（手番交代）
* 9x9盤
* 障害物（X）4つのランダム配置（開始前にON/OFF）
* 通常対局モード → 整理モード → 判定（スコア表示）
* リセット（最初から）

### 2-3. スコープ外（初版ではやらない）

* AI対戦／オンライン対戦
* 棋譜保存や共有
* ルール派生の複数モード
* 複雑なアニメーション（置いた感の最小演出は可）

---

## 3. ゲーム進行（状態遷移）

### 3-1. 状態一覧

* **SETUP**：開始設定（障害物の個数設定・ランダム配置の確定）
* **PLAY**：通常対局（交互に着手）
* **ORGANIZE**：整理モード（石を自由に移動）
* **RESULT**：判定結果表示（スコア）

### 3-2. 典型フロー

1. SETUP

* 「障害物X：個数」を選択
* 「ランダム配置」ボタンで自動配置
* 配置が気に入らなければ「もう一度ランダム」で再生成
* 配置を確定したら Start

2. PLAY

* 2人が交互に石を置く
* 終局操作（例：整理モードへ、投了、または双方パス等）はUIボタンで明示

3. ORGANIZE

* 盤面上の石をドラッグ等で自由に移動できる
* 「判定」ボタンが有効

4. RESULT

* 判定結果（スコア）を表示
* 「整理に戻る」「最初から」などの導線

---

## 4. 盤面仕様

### 4-1. サイズ

* **9x9固定**

### 4-2. 障害物（X）

* 個数：**ゲーム開始前に選択**（SETUPで指定）
* 生成タイミング：**SETUP中**（Start前）
* 配置：**ランダム**（自動配置）
* 再抽選：配置が気に入らない場合、**何度でも「もう一度ランダム配置」**できる
* 確定：Startを押した時点で配置確定（PLAY中は変化しない）

ルール：

* 障害物は石を置けないマス
* 整理モードでも障害物は動かない

> 重要：ランダム要素は「開始前のみ」。対局中に増減しない（理解コストを抑える）。

---

## 5. 操作仕様（入力）（入力）

### 5-1. PLAY（通常対局）

* 空きマスをクリック → 着手
* 着手できない条件（最低限）

  * 障害物（X）上
  * 既に石がある

### 5-2. ORGANIZE（整理モード）

* 盤面上の石を **ドラッグで移動**
* 置き先が不正の場合（障害物上、盤外、他石と重なる等）

  * その場で戻す、もしくは置けない表示（UI方針は実装側で統一）

> 整理モードは「対局ルール」より「編集操作の分かりやすさ」を優先する。

---

## 6. 判定（スコア算出）

### 6-1. タイミング

* **ORGANIZE** 状態で「判定」ボタンを押した時に算出

### 6-2. 出力

* 黒のスコア
* 白のスコア
* 差分／勝者表示（任意）

### 6-3. 期待される振る舞い

* 判定処理は結果を表示するだけで、盤面を改変しない
* 判定後に「整理に戻る」導線がある（判定やり直し可能）

> スコアロジックの詳細（地・死活・取りなど）は別ドキュメントに切り出し可能。

---

## 7. UI要件（最低限）

### 7-1. SETUP

* トグル：障害物X ON/OFF
* ボタン：Start

### 7-2. PLAY

* 表示：手番（黒/白）
* ボタン：整理モードへ（End / 整理開始）
* ボタン：最初から（Reset）

### 7-3. ORGANIZE

* 表示：整理モード中であること
* ボタン：判定
* ボタン：対局に戻る（任意：戻せるなら）
* ボタン：最初から

### 7-4. RESULT

* スコア表示（黒/白）
* ボタン：整理に戻る
* ボタン：最初から

---

## 8. 意味イベント（演出・ログ用：推奨）

このアプリは後付け演出を入れたいので、出来事（意味イベント）を用意する。

例：

* `GAME_STARTED({ withObstacles: boolean, obstacles: Point[] })`
* `STONE_PLACED({ player, point })`
* `MODE_CHANGED({ from, to })`（PLAY→ORGANIZEなど）
* `STONE_MOVED({ from, to })`（整理モード）
* `SCORE_REQUESTED()`
* `SCORE_COMPUTED({ black, white, detail? })`
* `GAME_RESET()`

> 演出やSEはイベント購読で実装し、判定ロジックを汚さない。

---

## 9. 実装の優先順位（推奨）

1. 9x9盤の描画と座標系
2. 障害物Xのランダム配置（ON/OFF）
3. PLAY：着手と手番
4. ORGANIZE：石の移動
5. 判定ボタン → スコア出力（暫定でも可）
6. RESULT：表示と再判定導線

---

## 10. 完了条件（Definition of Done）

* 2人で交互に着手できる（9x9）
* 開始時に障害物ON/OFFを選べ、ONならランダム4個置かれる
* 終局操作で整理モードに入り、石を自由に動かせる
* 判定ボタンでスコアが表示され、整理に戻って再判定できる
* リセットで最初からやり直せる
